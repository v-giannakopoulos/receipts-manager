<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Receipt & Warranty Manager</title>
  <link rel="stylesheet" href="/static/css/style.css" />
</head>

<body>
  <div class="container">
    <header>
      <h1>ğŸ“¦ Receipt & Warranty Manager</h1>
    </header>

    <div class="toolbar">
      <button type="button" id="importBtn" class="btn btn-primary">ğŸ“¥ Import JSON</button>
      <button type="button" id="exportJsonBtn" class="btn btn-secondary">ğŸ“¤ Export JSON</button>
      <button type="button" id="exportCsvBtn" class="btn btn-secondary">ğŸ“Š Export CSV</button>
      <button type="button" id="refreshBtn" class="btn btn-icon" title="Reload data & suggestions" aria-label="Reload data & suggestions">ğŸ”„</button>

      <!-- Hidden file input used by importBtn -->
      <input type="file" id="importInput" accept="application/json" hidden />
    </div>

    <div id="integrityBanner" class="banner-error" style="display:none;">
      <span id="integrityMessage"></span>
      <button type="button" id="recheckBtn" class="btn-small">ğŸ”„ Re-check Files Now</button>
      <button type="button" id="closeBannerBtn" class="btn-small" aria-label="Close">âœ•</button>
    </div>

    <!-- Upload zone MUST be #dropZone for your JS -->
    <div class="upload-zone" id="dropZone">
      <div class="upload-content">
        <div class="upload-icon">ğŸ“„</div>
        <p>
          Drag &amp; Drop receipt file here or
          <span class="browse-link" style="color:#2196f3; cursor:pointer; text-decoration:underline;">click to browse</span>
        </p>
        <p class="upload-hint">Supported: PDF, JPG, PNG (max 50MB)</p>
      </div>
      <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png" hidden />
    </div>

    <div class="filters">
      <input type="text" id="searchInput" placeholder="ğŸ” Search items..." class="search-input" />
      <select id="projectFilter" class="filter-select">
        <option value="">All Projects</option>
      </select>
      <select id="statusFilter" class="filter-select">
        <option value="">All Status</option>
        <option value="active">Active</option>
        <option value="expiring">Expiring Soon (90d)</option>
        <option value="expired">Expired</option>
      </select>
      <select id="userFilter" class="filter-select">
        <option value="">All Users</option>
      </select>
      <button type="button" id="columnToggleBtn" class="btn btn-icon" title="Toggle columns">âš™ï¸ Columns</button>
    </div>

    <!-- Column panel MUST exist for your JS -->
    <div id="columnPanel" class="column-panel" style="display:none;">
      <div class="column-panel-header">
        <strong>Visible columns</strong>
        <button type="button" id="closeColumnPanel" class="btn-small">âœ•</button>
      </div>

      <div class="column-panel-body">
        <label><input class="col-toggle" type="checkbox" data-column="id" checked /> ID</label>
        <label><input class="col-toggle" type="checkbox" data-column="receipt_group_id" checked /> Receipt Group</label>
        <label><input class="col-toggle" type="checkbox" data-column="brand" checked /> Brand</label>
        <label><input class="col-toggle" type="checkbox" data-column="model" checked /> Model</label>
        <label><input class="col-toggle" type="checkbox" data-column="location" checked /> Location</label>
        <label><input class="col-toggle" type="checkbox" data-column="users" checked /> Users</label>
        <label><input class="col-toggle" type="checkbox" data-column="project" checked /> Project</label>
        <label><input class="col-toggle" type="checkbox" data-column="shop" checked /> Shop</label>
        <label><input class="col-toggle" type="checkbox" data-column="purchase_date" checked /> Purchase Date</label>
        <label><input class="col-toggle" type="checkbox" data-column="documentation" checked /> Documentation</label>
        <label><input class="col-toggle" type="checkbox" data-column="guarantee" checked /> Guarantee</label>
        <label><input class="col-toggle" type="checkbox" data-column="guarantee_end_date" checked /> Guarantee End Date</label>
        <label><input class="col-toggle" type="checkbox" data-column="file" checked /> File</label>
      </div>
    </div>

    <div class="table-container">
      <table id="itemsTable">
        <thead>
          <tr>
            <th class="sortable" data-column="id">ID</th>
            <th class="sortable" data-column="receipt_group_id">Receipt Group</th>
            <th class="sortable" data-column="brand">Brand</th>
            <th class="sortable" data-column="model">Model</th>
            <th class="sortable" data-column="location">Location</th>
            <th data-column="users">Users</th>
            <th class="sortable" data-column="project">Project</th>
            <th class="sortable" data-column="shop">Shop</th>
            <th class="sortable" data-column="purchase_date">Purchase Date</th>
            <th data-column="documentation">Documentation</th>
            <th data-column="guarantee">Guarantee</th>
            <th class="sortable" data-column="guarantee_end_date">Guarantee End Date</th>
            <th data-column="file">File</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody id="tableBody">
          <tr class="empty-state">
            <td colspan="14">
              <div class="empty-message">
                <span class="empty-icon">ğŸ“¦</span>
                <p>No items yet. Upload a receipt to get started!</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="status-bar">
      <span id="itemCount">0 items</span>
    </div>
  </div>

  <!-- Datalists required by populateDataLists() -->
  <datalist id="shopList"></datalist>
  <datalist id="brandList"></datalist>
  <datalist id="modelList"></datalist>
  <datalist id="locationList"></datalist>
  <datalist id="docList"></datalist>
  <datalist id="projectList"></datalist>
  <datalist id="userList"></datalist>

  <!-- Minimal inputs so setupDateInput() + setupTagInput() don't fail.
       If you already have modals elsewhere in your file, keep those and just ensure IDs match. -->
  <div style="display:none;">
    <input id="receiptDate" />
    <input id="editDate" />

    <div id="userTags"><input id="userInput" list="userList" /></div>
    <div id="editUserTags"><input id="editUserInput" list="userList" /></div>
  </div>

  <script src="/static/js/app.js"></script>
</body>
</html>
